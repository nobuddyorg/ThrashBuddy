suite: Test Deployment Template
templates:
  - templates/deployment.yaml
tests:
  - it: should render a deployment for frontend
    set:
      deployments:
        frontend:
          name: frontend
          image: cloud-thrash/frontend:latest
          replicas: 2
          livenessPort: 8080
          resources:
            requests:
              cpu: "250m"
              memory: "256Mi"
              ephemeralStorage: "512Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
              ephemeralStorage: "1Gi"
        backend:
          name: backend
          image: cloud-thrash/backend:latest
          replicas: 1
          livenessPort: 8081
          resources:
            requests:
              cpu: "100m"
              memory: "128Mi"
              ephemeralStorage: "500Mi"
            limits:
              cpu: "200m"
              memory: "256Mi"
              ephemeralStorage: "750Mi"
    documentSelector:
      path: metadata.name
      value: frontend-deployment
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: frontend-deployment
      - equal:
          path: spec.replicas
          value: 2
      - equal:
          path: spec.template.spec.containers[0].name
          value: frontend
      - equal:
          path: spec.template.spec.containers[0].image
          value: cloud-thrash/frontend:latest
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.tcpSocket.port
          value: 8080
      - equal:
          path: spec.template.spec.containers[0].resources.requests.cpu
          value: "250m"
      - equal:
          path: spec.template.spec.containers[0].resources.requests.memory
          value: "256Mi"
      - equal:
          path: spec.template.spec.containers[0].resources.requests.ephemeral-storage
          value: "512Mi"
      - equal:
          path: spec.template.spec.containers[0].resources.limits.cpu
          value: "500m"
      - equal:
          path: spec.template.spec.containers[0].resources.limits.memory
          value: "512Mi"
      - equal:
          path: spec.template.spec.containers[0].resources.limits.ephemeral-storage
          value: "1Gi"
